/* DATA PRODUK GENTENG (merujuk ke komentar HTML: "Data produk genteng") */
const products = [
    {
        id: 1,
        title: "Genteng Morando Glasur",
        description: "Genteng kualitas premium dengan ketebalan Maksimal , tahan lama dan tahan cuaca ekstrim. Tersedia warna  brown dan transparan",
        price: "Rp 5.800 / buah",
        category: "top",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 2,
        title: "Genteng Morando Natural",
        description: "Genteng kualitas terbaik dengan permukaan halus dan warna merata, cocok untuk rumah mewah.",
        price: "Rp 2.600 / buah",
        category: "top",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 3,
        title: "Genteng Jenis Kodok",
        description: "Genteng kualitas baik dengan harga terjangkau, cocok untuk perumahan standar.",
        price: "Rp 1.900 / buah",
        category: "top",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 4,
        title: "Genteng Magas Biasa",
        description: "Genteng kualitas menengah atas dengan ketahanan baik, sedikit toleransi warna Tersedia magas orisinil L dan waferan.",
        price: "Rp 1.400 / buah",
        category: "kw1",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 5,
        title: "Genteng Magas Ekonomi",
        description: "Genteng kualitas menengah, cocok untuk bangunan dengan anggaran terbatas.",
        price: "Rp 1.300 / buah",
        category: "kw1",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 6,
        title: "Genteng Plentong Gepak",
        description: "Genteng ekonomis dengan kualitas memadai untuk bangunan sederhana.",
        price: "Rp 1.500 / buah",
        category: "kw1",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 7,
        title: "Genteng Plentong Bulet",
        description: "Genteng ekonomis kualitas terbaik di kelasnya, cocok untuk bangunan tambahan.",
        price: "Rp 1.500 / buah",
        category: "kw2",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 8,
        title: "Genteng Dorengan Gepak",
        description: "Genteng standar untuk gudang atau bangunan non-hunian, harga ekonomis.",
        price: "Rp 1.000 / buah",
        category: "kw2",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 9,
        title: "Genteng Dorengan Plentong",
        description: "Genteng harga termurah, cocok untuk bangunan sementara atau pagar.",
        price: "Rp 900 / buah",
        category: "kw2",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 10,
        title: "Genteng Kerpus Premium",
        description: "Genteng kerpus kualitas terbaik dengan ketebalan ekstra dan finishing premium.",
        price: "Rp 1.800 / buah",
        category: "kerpus",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    },
    {
        id: 11,
        title: "Genteng Kerpus Standar",
        description: "Genteng kerpus dengan kualitas bagus dan harga terjangkau.",
        price: "Rp 1.500 / buah",
        category: "kerpus",
        fullDescription: "Genteng kualitas premium dengan ketebalan maksimal...",
        specs: [
            "Dimensi: 30cm x 20cm x 1.5cm",
            "Berat: 2.5 kg/buah",
            "Kebutuhan per m²: 24 buah",
            "Garansi: 10 tahun"
        ]
    }
];

/* VARIABEL PENCARIAN */
let searchResults = [];
let currentSearchIndex = -1;

/* FUNGSI RENDER PRODUK */
function renderProducts(category = 'all') {
    const container = document.getElementById('products-container');
    container.innerHTML = '';
    
    const filteredProducts = category === 'all' 
        ? products 
        : products.filter(product => product.category === category);
    
    filteredProducts.forEach(product => {
        const badgeClass = `badge-${product.category}`;
        const badgeText = product.category === 'top' ? 'Top' : 
                         product.category === 'kerpus' ? 'Kerpus' : 
                         product.category === 'kw1' ? 'kw1' : 'kw2';
        
        const iconClass = product.category === 'top' ? 'fas fa-building' :
                          product.category === 'kerpus' ? 'fas fa-building' : 
                          product.category === 'kw1' ? 'fas fa-house-chimney' : 'fas fa-home';
        
        const productCard = `
    <div class="product-card" data-id="${product.id}">
        <div class="product-badge ${badgeClass}">${badgeText}</div>
        <div class="product-image">
            <i class="${iconClass}"></i>
        </div>
        <div class="product-info">
            <h3 class="product-title">${product.title}</h3>
            <div class="product-price">${product.price}</div>
            <p class="product-description">${product.description}</p>
            <div class="product-buttons">
                <a href="https://wa.me/6285282214033?text=Saya%20ingin%20memesan%20${encodeURIComponent(product.title)}" 
                   class="order-button" target="_blank">
                    <i class="fab fa-whatsapp"></i> Pesan Sekarang
                </a>
                <a href="product-detail.html?id=${product.id}" class="detail-button">
                    <i class="fas fa-eye"></i> Lihat Selengkapnya
                </a>
            </div>
        </div>
    </div>
`;
        
        container.innerHTML += productCard;
    });
}

/* FUNGSIONALITAS TAB KATEGORI */
document.querySelectorAll('.category-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.category-tab').forEach(t => {
            t.classList.remove('active');
        });
        
        tab.classList.add('active');
        
        const category = tab.getAttribute('data-category');
        renderProducts(category);
        
        document.getElementById('search-input').value = '';
        searchResults = [];
        currentSearchIndex = -1;
        document.getElementById('search-indicator').style.display = 'none';
    });
});

/* FUNGSI SCROLL KE PROMO */
function scrollToPromo() {
    const promoSection = document.getElementById('promo-section');
    promoSection.scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
    });
}

/* FUNGSI PENCARIAN PRODUK */
function performSearch() {
    const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
    if (searchTerm) {
        const filtered = products.filter(product => 
            product.title.toLowerCase().includes(searchTerm) || 
            product.description.toLowerCase().includes(searchTerm)
        );
        renderFilteredProducts(filtered);
    } else {
        renderProducts();
        document.getElementById('search-indicator').style.display = 'none';
        searchResults = [];
        currentSearchIndex = -1;
    }
}

/* RENDER HASIL PENCARIAN */
function renderFilteredProducts(filteredProducts) {
    const container = document.getElementById('products-container');
    container.innerHTML = '';
    
    if (filteredProducts.length === 0) {
        container.innerHTML = '<p class="no-results">Produk tidak ditemukan. Coba kata kunci lain.</p>';
        document.getElementById('search-indicator').style.display = 'none';
        searchResults = [];
        currentSearchIndex = -1;
        return;
    }
    
    filteredProducts.forEach(product => {
        const badgeClass = `badge-${product.category}`;
        const badgeText = product.category === 'top' ? 'Top' : 
                         product.category === 'kerpus' ? 'Kerpus' : 
                         product.category === 'kw1' ? 'kw1' : 'kw2';
        
        const iconClass = product.category === 'top' ? 'fas fa-building' :
                          product.category === 'kerpus' ? 'fas fa-building' : 
                          product.category === 'kw1' ? 'fas fa-house-chimney' : 'fas fa-home';
        
        const productCard = `
    <div class="product-card" data-id="${product.id}">
        <div class="product-badge ${badgeClass}">${badgeText}</div>
        <div class="product-image">
            <i class="${iconClass}"></i>
        </div>
        <div class="product-info">
            <h3 class="product-title">${product.title}</h3>
            <div class="product-price">${product.price}</div>
            <p class="product-description">${product.description}</p>
            <div class="product-buttons">
                <a href="https://wa.me/6285282214033?text=Saya%20ingin%20memesan%20${encodeURIComponent(product.title)}" 
                   class="order-button" target="_blank">
                    <i class="fab fa-whatsapp"></i> Pesan Sekarang
                </a>
                <a href="product-detail.html?id=${product.id}" class="detail-button">
                    <i class="fas fa-eye"></i> Lihat Selengkapnya
                </a>
            </div>
        </div>
    </div>
`;
        
        container.innerHTML += productCard;
    });
    
    searchResults = Array.from(document.querySelectorAll('.product-card'));
    
    document.getElementById('current-result').textContent = '0';
    document.getElementById('total-results').textContent = searchResults.length;
    document.getElementById('search-indicator').style.display = 'flex';
    
    navigateSearchResults(0);
}

/* NAVIGASI HASIL PENCARIAN */
function navigateSearchResults(index) {
    if (searchResults.length === 0) return;
    
    if (index < 0) index = searchResults.length - 1;
    if (index >= searchResults.length) index = 0;
    
    searchResults.forEach(card => card.classList.remove('search-highlight'));
    
    currentSearchIndex = index;
    const currentCard = searchResults[currentSearchIndex];
    currentCard.classList.add('search-highlight');
    
    document.getElementById('current-result').textContent = currentSearchIndex + 1;
    
    const headerHeight = document.querySelector('header').offsetHeight;
    const yOffset = -headerHeight - 20;
    
    const y = currentCard.getBoundingClientRect().top + window.pageYOffset + yOffset;
    window.scrollTo({top: y, behavior: 'smooth'});
}

/* INISIALISASI SAAT DOKUMEN SIAP */
document.addEventListener('DOMContentLoaded', () => {
    renderProducts();
    
    document.getElementById('search-input').focus();
    
    document.getElementById('search-button').addEventListener('click', performSearch);
    
    document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performSearch();
    });
    
    document.addEventListener('click', function(e) {
        if (e.target.closest('.detail-button')) {
            e.preventDefault();
            const productId = e.target.closest('.product-card').dataset.id;
            const product = products.find(p => p.id == productId);
            
            // Simpan produk di localStorage
            localStorage.setItem('selectedProduct', JSON.stringify(product));
            
            // Redirect ke halaman detail
            window.location.href = 'product-detail.html';
        }
    });
    
    document.getElementById('prev-result').addEventListener('click', () => {
        navigateSearchResults(currentSearchIndex - 1);
    });
    
    document.getElementById('next-result').addEventListener('click', () => {
        navigateSearchResults(currentSearchIndex + 1);
    });
    
    document.getElementById('close-indicator').addEventListener('click', () => {
        document.getElementById('search-indicator').style.display = 'none';
        searchResults.forEach(card => card.classList.remove('search-highlight'));
        searchResults = [];
        currentSearchIndex = -1;
    });
    
    document.getElementById('promo-button').addEventListener('click', scrollToPromo);
    
    document.addEventListener('keydown', (e) => {
        if (searchResults.length > 0) {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                navigateSearchResults(currentSearchIndex - 1);
                e.preventDefault();
            } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                navigateSearchResults(currentSearchIndex + 1);
                e.preventDefault();
            }
        }
    });
});
